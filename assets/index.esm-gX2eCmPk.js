const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/esm-WMGHUIL7-yhki3Y2y.js","assets/index-DAtEUpr3.js","assets/index.esm-C-jz8WLf.js","assets/index.esm-DIyynJVA.js","assets/index.esm-DfotAdpM.js","assets/index.esm-CmSQaEKv.js","assets/index.esm-COc-PyqV.js","assets/import-wrapper-prod-mRNndFxq.js","assets/combineLatest-Cx3jWXTV.js","assets/tap-CWNNm5Pt.js","assets/firstValueFrom-Ch7AjPMY.js"])))=>i.map(i=>d[i]);
import{_ as he}from"./index-DAtEUpr3.js";import{O as pe,B as X,i as de}from"./index.esm-C-jz8WLf.js";import{storage as dt,JsonParser as yt}from"./index.esm-COc-PyqV.js";import{r as fe,o as we,i as me,c as Pt,t as ge,n as ye,k as vt,l as Rt,C as H,h as Vt,d as Dt,S as ot,m as F,s as Bt,a as tt,g as Be}from"./index.esm-DfotAdpM.js";import{e as Ee,a0 as Mt,j as nt,a1 as Ie,a2 as Se,a3 as Ae,b as Wt,a4 as Te,a as Ce,a5 as ke,c as _e,$ as xe}from"./index.esm-DIyynJVA.js";import{B as Kt,c as Nt}from"./combineLatest-Cx3jWXTV.js";import{d as G,s as st,o as Ue,m as Ot,a as be,c as $e}from"./index.esm-CmSQaEKv.js";import{t as Lt}from"./tap-CWNNm5Pt.js";import{f as it}from"./firstValueFrom-Ch7AjPMY.js";function Pe(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var c=fe(o);return we(function(p,h){for(var d=o.length,a=new Array(d),y=o.map(function(){return!1}),m=!1,_=function(E){me(o[E]).subscribe(Pt(h,function(T){a[E]=T,!m&&!y[E]&&(y[E]=!0,(m=y.every(ge))&&(y=null))},ye))},B=0;B<d;B++)_(B);p.subscribe(Pt(h,function(E){if(m){var T=vt([E],Rt(a));h.next(c?c.apply(void 0,vt([],Rt(T))):T)}}))})}var ve=Object.create,at=Object.defineProperty,Re=Object.getOwnPropertyDescriptor,Et=Object.getOwnPropertyNames,De=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty,Q=(o,s)=>function(){return o&&(s=(0,o[Et(o)[0]])(o=0)),s},cr=(o,s)=>function(){return s||(0,o[Et(o)[0]])((s={exports:{}}).exports,s),s.exports},hr=(o,s)=>{for(var c in s)at(o,c,{get:s[c],enumerable:!0})},Gt=(o,s,c,p)=>{if(s&&typeof s=="object"||typeof s=="function")for(let h of Et(s))!Me.call(o,h)&&h!==c&&at(o,h,{get:()=>s[h],enumerable:!(p=Re(s,h))||p.enumerable});return o},pr=(o,s,c)=>(c=o!=null?ve(De(o)):{},Gt(!o||!o.__esModule?at(c,"default",{value:o,enumerable:!0}):c,o)),dr=o=>Gt(at({},"__esModule",{value:!0}),o),b=Q({"<define:__environment__>"(){}}),$=Q({"node_modules/.pnpm/esbuild-plugin-polyfill-node@0.3.0_esbuild@0.23.0/node_modules/esbuild-plugin-polyfill-node/polyfills/__dirname.js"(){}});function Ne(){if(ft)return J;ft=!0,J.byteLength=y,J.toByteArray=_,J.fromByteArray=T;for(var o=[],s=[],c=typeof Uint8Array<"u"?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,d=p.length;h<d;++h)o[h]=p[h],s[p.charCodeAt(h)]=h;s[45]=62,s[95]=63;function a(f){var w=f.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=f.indexOf("=");I===-1&&(I=w);var k=I===w?0:4-I%4;return[I,k]}function y(f){var w=a(f),I=w[0],k=w[1];return(I+k)*3/4-k}function m(f,w,I){return(w+I)*3/4-I}function _(f){var w,I=a(f),k=I[0],R=I[1],A=new c(m(f,k,R)),D=0,O=R>0?k-4:k,N;for(N=0;N<O;N+=4)w=s[f.charCodeAt(N)]<<18|s[f.charCodeAt(N+1)]<<12|s[f.charCodeAt(N+2)]<<6|s[f.charCodeAt(N+3)],A[D++]=w>>16&255,A[D++]=w>>8&255,A[D++]=w&255;return R===2&&(w=s[f.charCodeAt(N)]<<2|s[f.charCodeAt(N+1)]>>4,A[D++]=w&255),R===1&&(w=s[f.charCodeAt(N)]<<10|s[f.charCodeAt(N+1)]<<4|s[f.charCodeAt(N+2)]>>2,A[D++]=w>>8&255,A[D++]=w&255),A}function B(f){return o[f>>18&63]+o[f>>12&63]+o[f>>6&63]+o[f&63]}function E(f,w,I){for(var k,R=[],A=w;A<I;A+=3)k=(f[A]<<16&16711680)+(f[A+1]<<8&65280)+(f[A+2]&255),R.push(B(k));return R.join("")}function T(f){for(var w,I=f.length,k=I%3,R=[],A=16383,D=0,O=I-k;D<O;D+=A)R.push(E(f,D,D+A>O?O:D+A));return k===1?(w=f[I-1],R.push(o[w>>2]+o[w<<4&63]+"==")):k===2&&(w=(f[I-2]<<8)+f[I-1],R.push(o[w>>10]+o[w>>4&63]+o[w<<2&63]+"=")),R.join("")}return J}function Oe(){return wt||(wt=!0,et.read=function(o,s,c,p,h){var d,a,y=h*8-p-1,m=(1<<y)-1,_=m>>1,B=-7,E=c?h-1:0,T=c?-1:1,f=o[s+E];for(E+=T,d=f&(1<<-B)-1,f>>=-B,B+=y;B>0;d=d*256+o[s+E],E+=T,B-=8);for(a=d&(1<<-B)-1,d>>=-B,B+=p;B>0;a=a*256+o[s+E],E+=T,B-=8);if(d===0)d=1-_;else{if(d===m)return a?NaN:(f?-1:1)*(1/0);a=a+Math.pow(2,p),d=d-_}return(f?-1:1)*a*Math.pow(2,d-p)},et.write=function(o,s,c,p,h,d){var a,y,m,_=d*8-h-1,B=(1<<_)-1,E=B>>1,T=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=p?0:d-1,w=p?1:-1,I=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(y=isNaN(s)?1:0,a=B):(a=Math.floor(Math.log(s)/Math.LN2),s*(m=Math.pow(2,-a))<1&&(a--,m*=2),a+E>=1?s+=T/m:s+=T*Math.pow(2,1-E),s*m>=2&&(a++,m/=2),a+E>=B?(y=0,a=B):a+E>=1?(y=(s*m-1)*Math.pow(2,h),a=a+E):(y=s*Math.pow(2,E-1)*Math.pow(2,h),a=0));h>=8;o[c+f]=y&255,f+=w,y/=256,h-=8);for(a=a<<h|y,_+=h;_>0;o[c+f]=a&255,f+=w,a/=256,_-=8);o[c+f-w]|=I*128}),et}function Le(){if(mt)return K;mt=!0;const o=Ne(),s=Oe(),c=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;K.Buffer=a,K.SlowBuffer=R,K.INSPECT_MAX_BYTES=50;const p=2147483647;K.kMaxLength=p,a.TYPED_ARRAY_SUPPORT=h(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const r=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(r,t),r.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function d(r){if(r>p)throw new RangeError('The value "'+r+'" is invalid for option "size"');const t=new Uint8Array(r);return Object.setPrototypeOf(t,a.prototype),t}function a(r,t,e){if(typeof r=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return B(r)}return y(r,t,e)}a.poolSize=8192;function y(r,t,e){if(typeof r=="string")return E(r,t);if(ArrayBuffer.isView(r))return f(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(j(r,ArrayBuffer)||r&&j(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(j(r,SharedArrayBuffer)||r&&j(r.buffer,SharedArrayBuffer)))return w(r,t,e);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return a.from(n,t,e);const i=I(r);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return a.from(r[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}a.from=function(r,t,e){return y(r,t,e)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function m(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function _(r,t,e){return m(r),r<=0?d(r):t!==void 0?typeof e=="string"?d(r).fill(t,e):d(r).fill(t):d(r)}a.alloc=function(r,t,e){return _(r,t,e)};function B(r){return m(r),d(r<0?0:k(r)|0)}a.allocUnsafe=function(r){return B(r)},a.allocUnsafeSlow=function(r){return B(r)};function E(r,t){if((typeof t!="string"||t==="")&&(t="utf8"),!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const e=A(r,t)|0;let n=d(e);const i=n.write(r,t);return i!==e&&(n=n.slice(0,i)),n}function T(r){const t=r.length<0?0:k(r.length)|0,e=d(t);for(let n=0;n<t;n+=1)e[n]=r[n]&255;return e}function f(r){if(j(r,Uint8Array)){const t=new Uint8Array(r);return w(t.buffer,t.byteOffset,t.byteLength)}return T(r)}function w(r,t,e){if(t<0||r.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');let n;return t===void 0&&e===void 0?n=new Uint8Array(r):e===void 0?n=new Uint8Array(r,t):n=new Uint8Array(r,t,e),Object.setPrototypeOf(n,a.prototype),n}function I(r){if(a.isBuffer(r)){const t=k(r.length)|0,e=d(t);return e.length===0||r.copy(e,0,0,t),e}if(r.length!==void 0)return typeof r.length!="number"||ct(r.length)?d(0):T(r);if(r.type==="Buffer"&&Array.isArray(r.data))return T(r.data)}function k(r){if(r>=p)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+p.toString(16)+" bytes");return r|0}function R(r){return+r!=r&&(r=0),a.alloc(+r)}a.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==a.prototype},a.compare=function(t,e){if(j(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),j(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,i=e.length;for(let u=0,l=Math.min(n,i);u<l;++u)if(t[u]!==e[u]){n=t[u],i=e[u];break}return n<i?-1:i<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return a.alloc(0);let n;if(e===void 0)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const i=a.allocUnsafe(e);let u=0;for(n=0;n<t.length;++n){let l=t[n];if(j(l,Uint8Array))u+l.length>i.length?(a.isBuffer(l)||(l=a.from(l)),l.copy(i,u)):Uint8Array.prototype.set.call(i,l,u);else if(a.isBuffer(l))l.copy(i,u);else throw new TypeError('"list" argument must be an Array of Buffers');u+=l.length}return i};function A(r,t){if(a.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||j(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);const e=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&e===0)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return lt(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return $t(r).length;default:if(i)return n?-1:lt(r).length;t=(""+t).toLowerCase(),i=!0}}a.byteLength=A;function D(r,t,e){let n=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(r||(r="utf8");;)switch(r){case"hex":return re(this,t,e);case"utf8":case"utf-8":return St(this,t,e);case"ascii":return te(this,t,e);case"latin1":case"binary":return ee(this,t,e);case"base64":return Qt(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,t,e);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}a.prototype._isBuffer=!0;function O(r,t,e){const n=r[t];r[t]=r[e],r[e]=n}a.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)O(this,e,e+1);return this},a.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)O(this,e,e+3),O(this,e+1,e+2);return this},a.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)O(this,e,e+7),O(this,e+1,e+6),O(this,e+2,e+5),O(this,e+3,e+4);return this},a.prototype.toString=function(){const t=this.length;return t===0?"":arguments.length===0?St(this,0,t):D.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:a.compare(this,t)===0},a.prototype.inspect=function(){let t="";const e=K.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},c&&(a.prototype[c]=a.prototype.inspect),a.prototype.compare=function(t,e,n,i,u){if(j(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),n===void 0&&(n=t?t.length:0),i===void 0&&(i=0),u===void 0&&(u=this.length),e<0||n>t.length||i<0||u>this.length)throw new RangeError("out of range index");if(i>=u&&e>=n)return 0;if(i>=u)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,i>>>=0,u>>>=0,this===t)return 0;let l=u-i,g=n-e;const x=Math.min(l,g),C=this.slice(i,u),U=t.slice(e,n);for(let S=0;S<x;++S)if(C[S]!==U[S]){l=C[S],g=U[S];break}return l<g?-1:g<l?1:0};function N(r,t,e,n,i){if(r.length===0)return-1;if(typeof e=="string"?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,ct(e)&&(e=i?0:r.length-1),e<0&&(e=r.length+e),e>=r.length){if(i)return-1;e=r.length-1}else if(e<0)if(i)e=0;else return-1;if(typeof t=="string"&&(t=a.from(t,n)),a.isBuffer(t))return t.length===0?-1:It(r,t,e,n,i);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,t,e):Uint8Array.prototype.lastIndexOf.call(r,t,e):It(r,[t],e,n,i);throw new TypeError("val must be string, number or Buffer")}function It(r,t,e,n,i){let u=1,l=r.length,g=t.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||t.length<2)return-1;u=2,l/=2,g/=2,e/=2}function x(U,S){return u===1?U[S]:U.readUInt16BE(S*u)}let C;if(i){let U=-1;for(C=e;C<l;C++)if(x(r,C)===x(t,U===-1?0:C-U)){if(U===-1&&(U=C),C-U+1===g)return U*u}else U!==-1&&(C-=C-U),U=-1}else for(e+g>l&&(e=l-g),C=e;C>=0;C--){let U=!0;for(let S=0;S<g;S++)if(x(r,C+S)!==x(t,S)){U=!1;break}if(U)return C}return-1}a.prototype.includes=function(t,e,n){return this.indexOf(t,e,n)!==-1},a.prototype.indexOf=function(t,e,n){return N(this,t,e,n,!0)},a.prototype.lastIndexOf=function(t,e,n){return N(this,t,e,n,!1)};function qt(r,t,e,n){e=Number(e)||0;const i=r.length-e;n?(n=Number(n),n>i&&(n=i)):n=i;const u=t.length;n>u/2&&(n=u/2);let l;for(l=0;l<n;++l){const g=parseInt(t.substr(l*2,2),16);if(ct(g))return l;r[e+l]=g}return l}function Yt(r,t,e,n){return rt(lt(t,r.length-e),r,e,n)}function zt(r,t,e,n){return rt(ae(t),r,e,n)}function Jt(r,t,e,n){return rt($t(t),r,e,n)}function Xt(r,t,e,n){return rt(ue(t,r.length-e),r,e,n)}a.prototype.write=function(t,e,n,i){if(e===void 0)i="utf8",n=this.length,e=0;else if(n===void 0&&typeof e=="string")i=e,n=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const u=this.length-e;if((n===void 0||n>u)&&(n=u),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let l=!1;for(;;)switch(i){case"hex":return qt(this,t,e,n);case"utf8":case"utf-8":return Yt(this,t,e,n);case"ascii":case"latin1":case"binary":return zt(this,t,e,n);case"base64":return Jt(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Xt(this,t,e,n);default:if(l)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),l=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Qt(r,t,e){return t===0&&e===r.length?o.fromByteArray(r):o.fromByteArray(r.slice(t,e))}function St(r,t,e){e=Math.min(r.length,e);const n=[];let i=t;for(;i<e;){const u=r[i];let l=null,g=u>239?4:u>223?3:u>191?2:1;if(i+g<=e){let x,C,U,S;switch(g){case 1:u<128&&(l=u);break;case 2:x=r[i+1],(x&192)===128&&(S=(u&31)<<6|x&63,S>127&&(l=S));break;case 3:x=r[i+1],C=r[i+2],(x&192)===128&&(C&192)===128&&(S=(u&15)<<12|(x&63)<<6|C&63,S>2047&&(S<55296||S>57343)&&(l=S));break;case 4:x=r[i+1],C=r[i+2],U=r[i+3],(x&192)===128&&(C&192)===128&&(U&192)===128&&(S=(u&15)<<18|(x&63)<<12|(C&63)<<6|U&63,S>65535&&S<1114112&&(l=S))}}l===null?(l=65533,g=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|l&1023),n.push(l),i+=g}return Zt(n)}const At=4096;function Zt(r){const t=r.length;if(t<=At)return String.fromCharCode.apply(String,r);let e="",n=0;for(;n<t;)e+=String.fromCharCode.apply(String,r.slice(n,n+=At));return e}function te(r,t,e){let n="";e=Math.min(r.length,e);for(let i=t;i<e;++i)n+=String.fromCharCode(r[i]&127);return n}function ee(r,t,e){let n="";e=Math.min(r.length,e);for(let i=t;i<e;++i)n+=String.fromCharCode(r[i]);return n}function re(r,t,e){const n=r.length;(!t||t<0)&&(t=0),(!e||e<0||e>n)&&(e=n);let i="";for(let u=t;u<e;++u)i+=le[r[u]];return i}function ne(r,t,e){const n=r.slice(t,e);let i="";for(let u=0;u<n.length-1;u+=2)i+=String.fromCharCode(n[u]+n[u+1]*256);return i}a.prototype.slice=function(t,e){const n=this.length;t=~~t,e=e===void 0?n:~~e,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),e<t&&(e=t);const i=this.subarray(t,e);return Object.setPrototypeOf(i,a.prototype),i};function M(r,t,e){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+t>e)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,n){t=t>>>0,e=e>>>0,n||M(t,e,this.length);let i=this[t],u=1,l=0;for(;++l<e&&(u*=256);)i+=this[t+l]*u;return i},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,n){t=t>>>0,e=e>>>0,n||M(t,e,this.length);let i=this[t+--e],u=1;for(;e>0&&(u*=256);)i+=this[t+--e]*u;return i},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t=t>>>0,e||M(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||M(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||M(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||M(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readBigUInt64LE=V(function(t){t=t>>>0,Y(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&Z(t,this.length-8);const i=e+this[++t]*2**8+this[++t]*2**16+this[++t]*2**24,u=this[++t]+this[++t]*2**8+this[++t]*2**16+n*2**24;return BigInt(i)+(BigInt(u)<<BigInt(32))}),a.prototype.readBigUInt64BE=V(function(t){t=t>>>0,Y(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&Z(t,this.length-8);const i=e*2**24+this[++t]*2**16+this[++t]*2**8+this[++t],u=this[++t]*2**24+this[++t]*2**16+this[++t]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(u)}),a.prototype.readIntLE=function(t,e,n){t=t>>>0,e=e>>>0,n||M(t,e,this.length);let i=this[t],u=1,l=0;for(;++l<e&&(u*=256);)i+=this[t+l]*u;return u*=128,i>=u&&(i-=Math.pow(2,8*e)),i},a.prototype.readIntBE=function(t,e,n){t=t>>>0,e=e>>>0,n||M(t,e,this.length);let i=e,u=1,l=this[t+--i];for(;i>0&&(u*=256);)l+=this[t+--i]*u;return u*=128,l>=u&&(l-=Math.pow(2,8*e)),l},a.prototype.readInt8=function(t,e){return t=t>>>0,e||M(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},a.prototype.readInt16LE=function(t,e){t=t>>>0,e||M(t,2,this.length);const n=this[t]|this[t+1]<<8;return n&32768?n|4294901760:n},a.prototype.readInt16BE=function(t,e){t=t>>>0,e||M(t,2,this.length);const n=this[t+1]|this[t]<<8;return n&32768?n|4294901760:n},a.prototype.readInt32LE=function(t,e){return t=t>>>0,e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t=t>>>0,e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readBigInt64LE=V(function(t){t=t>>>0,Y(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&Z(t,this.length-8);const i=this[t+4]+this[t+5]*2**8+this[t+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(e+this[++t]*2**8+this[++t]*2**16+this[++t]*2**24)}),a.prototype.readBigInt64BE=V(function(t){t=t>>>0,Y(t,"offset");const e=this[t],n=this[t+7];(e===void 0||n===void 0)&&Z(t,this.length-8);const i=(e<<24)+this[++t]*2**16+this[++t]*2**8+this[++t];return(BigInt(i)<<BigInt(32))+BigInt(this[++t]*2**24+this[++t]*2**16+this[++t]*2**8+n)}),a.prototype.readFloatLE=function(t,e){return t=t>>>0,e||M(t,4,this.length),s.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t=t>>>0,e||M(t,4,this.length),s.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||M(t,8,this.length),s.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||M(t,8,this.length),s.read(this,t,!1,52,8)};function L(r,t,e,n,i,u){if(!a.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<u)throw new RangeError('"value" argument is out of bounds');if(e+n>r.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,n,i){if(t=+t,e=e>>>0,n=n>>>0,!i){const g=Math.pow(2,8*n)-1;L(this,t,e,n,g,0)}let u=1,l=0;for(this[e]=t&255;++l<n&&(u*=256);)this[e+l]=t/u&255;return e+n},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,n,i){if(t=+t,e=e>>>0,n=n>>>0,!i){const g=Math.pow(2,8*n)-1;L(this,t,e,n,g,0)}let u=n-1,l=1;for(this[e+u]=t&255;--u>=0&&(l*=256);)this[e+u]=t/l&255;return e+n},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,1,255,0),this[e]=t&255,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function Tt(r,t,e,n,i){bt(t,n,i,r,e,7);let u=Number(t&BigInt(4294967295));r[e++]=u,u=u>>8,r[e++]=u,u=u>>8,r[e++]=u,u=u>>8,r[e++]=u;let l=Number(t>>BigInt(32)&BigInt(4294967295));return r[e++]=l,l=l>>8,r[e++]=l,l=l>>8,r[e++]=l,l=l>>8,r[e++]=l,e}function Ct(r,t,e,n,i){bt(t,n,i,r,e,7);let u=Number(t&BigInt(4294967295));r[e+7]=u,u=u>>8,r[e+6]=u,u=u>>8,r[e+5]=u,u=u>>8,r[e+4]=u;let l=Number(t>>BigInt(32)&BigInt(4294967295));return r[e+3]=l,l=l>>8,r[e+2]=l,l=l>>8,r[e+1]=l,l=l>>8,r[e]=l,e+8}a.prototype.writeBigUInt64LE=V(function(t,e=0){return Tt(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=V(function(t,e=0){return Ct(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e=e>>>0,!i){const x=Math.pow(2,8*n-1);L(this,t,e,n,x-1,-x)}let u=0,l=1,g=0;for(this[e]=t&255;++u<n&&(l*=256);)t<0&&g===0&&this[e+u-1]!==0&&(g=1),this[e+u]=(t/l>>0)-g&255;return e+n},a.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e=e>>>0,!i){const x=Math.pow(2,8*n-1);L(this,t,e,n,x-1,-x)}let u=n-1,l=1,g=0;for(this[e+u]=t&255;--u>=0&&(l*=256);)t<0&&g===0&&this[e+u+1]!==0&&(g=1),this[e+u]=(t/l>>0)-g&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e=e>>>0,n||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4},a.prototype.writeBigInt64LE=V(function(t,e=0){return Tt(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=V(function(t,e=0){return Ct(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function kt(r,t,e,n,i,u){if(e+n>r.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function _t(r,t,e,n,i){return t=+t,e=e>>>0,i||kt(r,t,e,4),s.write(r,t,e,n,23,4),e+4}a.prototype.writeFloatLE=function(t,e,n){return _t(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return _t(this,t,e,!1,n)};function xt(r,t,e,n,i){return t=+t,e=e>>>0,i||kt(r,t,e,8),s.write(r,t,e,n,52,8),e+8}a.prototype.writeDoubleLE=function(t,e,n){return xt(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return xt(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,i){if(!a.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);const u=i-n;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,n,i):Uint8Array.prototype.set.call(t,this.subarray(n,i),e),u},a.prototype.fill=function(t,e,n,i){if(typeof t=="string"){if(typeof e=="string"?(i=e,e=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(t.length===1){const l=t.charCodeAt(0);(i==="utf8"&&l<128||i==="latin1")&&(t=l)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;e=e>>>0,n=n===void 0?this.length:n>>>0,t||(t=0);let u;if(typeof t=="number")for(u=e;u<n;++u)this[u]=t;else{const l=a.isBuffer(t)?t:a.from(t,i),g=l.length;if(g===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(u=0;u<n-e;++u)this[u+e]=l[u%g]}return this};const q={};function ut(r,t,e){q[r]=class extends e{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}ut("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ut("ERR_INVALID_ARG_TYPE",function(r,t){return`The "${r}" argument must be of type number. Received type ${typeof t}`},TypeError),ut("ERR_OUT_OF_RANGE",function(r,t,e){let n=`The value of "${r}" is out of range.`,i=e;return Number.isInteger(e)&&Math.abs(e)>2**32?i=Ut(String(e)):typeof e=="bigint"&&(i=String(e),(e>BigInt(2)**BigInt(32)||e<-(BigInt(2)**BigInt(32)))&&(i=Ut(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n},RangeError);function Ut(r){let t="",e=r.length;const n=r[0]==="-"?1:0;for(;e>=n+4;e-=3)t=`_${r.slice(e-3,e)}${t}`;return`${r.slice(0,e)}${t}`}function ie(r,t,e){Y(t,"offset"),(r[t]===void 0||r[t+e]===void 0)&&Z(t,r.length-(e+1))}function bt(r,t,e,n,i,u){if(r>e||r<t){const l=typeof t=="bigint"?"n":"";let g;throw t===0||t===BigInt(0)?g=`>= 0${l} and < 2${l} ** ${(u+1)*8}${l}`:g=`>= -(2${l} ** ${(u+1)*8-1}${l}) and < 2 ** ${(u+1)*8-1}${l}`,new q.ERR_OUT_OF_RANGE("value",g,r)}ie(n,i,u)}function Y(r,t){if(typeof r!="number")throw new q.ERR_INVALID_ARG_TYPE(t,"number",r)}function Z(r,t,e){throw Math.floor(r)!==r?(Y(r,e),new q.ERR_OUT_OF_RANGE("offset","an integer",r)):t<0?new q.ERR_BUFFER_OUT_OF_BOUNDS:new q.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,r)}const oe=/[^+/0-9A-Za-z-_]/g;function se(r){if(r=r.split("=")[0],r=r.trim().replace(oe,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function lt(r,t){t=t||1/0;let e;const n=r.length;let i=null;const u=[];for(let l=0;l<n;++l){if(e=r.charCodeAt(l),e>55295&&e<57344){if(!i){if(e>56319){(t-=3)>-1&&u.push(239,191,189);continue}else if(l+1===n){(t-=3)>-1&&u.push(239,191,189);continue}i=e;continue}if(e<56320){(t-=3)>-1&&u.push(239,191,189),i=e;continue}e=(i-55296<<10|e-56320)+65536}else i&&(t-=3)>-1&&u.push(239,191,189);if(i=null,e<128){if((t-=1)<0)break;u.push(e)}else if(e<2048){if((t-=2)<0)break;u.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;u.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;u.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return u}function ae(r){const t=[];for(let e=0;e<r.length;++e)t.push(r.charCodeAt(e)&255);return t}function ue(r,t){let e,n,i;const u=[];for(let l=0;l<r.length&&!((t-=2)<0);++l)e=r.charCodeAt(l),n=e>>8,i=e%256,u.push(i),u.push(n);return u}function $t(r){return o.toByteArray(se(r))}function rt(r,t,e,n){let i;for(i=0;i<n&&!(i+e>=t.length||i>=r.length);++i)t[i+e]=r[i];return i}function j(r,t){return r instanceof t||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===t.name}function ct(r){return r!==r}const le=function(){const r="0123456789abcdef",t=new Array(256);for(let e=0;e<16;++e){const n=e*16;for(let i=0;i<16;++i)t[n+i]=r[e]+r[i]}return t}();function V(r){return typeof BigInt>"u"?ce:r}function ce(){throw new Error("BigInt not supported")}return K}var J,ft,et,wt,K,mt,W,Fe,je=Q({"node_modules/.pnpm/@jspm+core@2.0.1/node_modules/@jspm/core/nodelibs/browser/buffer.js"(){b(),$(),P(),v(),J={},ft=!1,et={},wt=!1,K={},mt=!1,W=Le(),W.Buffer,W.SlowBuffer,W.INSPECT_MAX_BYTES,W.kMaxLength,Fe=W.Buffer,W.INSPECT_MAX_BYTES,W.kMaxLength}}),P=Q({"node_modules/.pnpm/esbuild-plugin-polyfill-node@0.3.0_esbuild@0.23.0/node_modules/esbuild-plugin-polyfill-node/polyfills/buffer.js"(){je()}}),z,ht,He=Q({"node_modules/.pnpm/@jspm+core@2.0.1/node_modules/@jspm/core/nodelibs/browser/process.js"(){b(),$(),P(),v(),z={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},z.now===void 0&&(ht=Date.now(),z.timing&&z.timing.navigationStart&&(ht=z.timing.navigationStart),z.now=()=>Date.now()-ht)}}),v=Q({"node_modules/.pnpm/esbuild-plugin-polyfill-node@0.3.0_esbuild@0.23.0/node_modules/esbuild-plugin-polyfill-node/polyfills/process.js"(){He()}}),Ft=class{constructor(o,s=null){this.name=o,this.initValue=s,this.valueState$=new Kt(Ve(this.name)??this.initValue),this.value$=this.valueState$,this.originalValue=null}get value(){return this.valueState$.value}setValue(o){this.valueState$.next(o),pt(this.name,o)}resetValue(){this.valueState$.next(this.originalValue),pt(this.name,this.originalValue)}cleanValue(){this.valueState$.next(null),pt(this.name,null)}startChangingValue(){if(this.originalValue!==null)throw new Error("value changing in progress");this.originalValue=this.value}endChangingValue(){this.originalValue=null}},gt="one-inch-settings";function pt(o,s){const c=dt.get(gt,yt)??{};dt.set(gt,{...c,[o]:s})}function Ve(o){const s=dt.get(gt,yt);return s===null?null:Reflect.get(s,o)}b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();var jt=class{constructor(){this.lastSnapshot={token:null,amount:null},this.signalChange$=new ot}setToken(o){const{token:s}=this.lastSnapshot;s&&o&&de(s,o)||(this.lastSnapshot={...this.lastSnapshot,token:o,amount:0n},this.signalChange$.next())}setAmount(o){const{amount:s}=this.lastSnapshot;s!==o&&(this.lastSnapshot={...this.lastSnapshot,amount:o},this.signalChange$.next())}getSnapshot(){return this.lastSnapshot}streamSnapshot(){return this.signalChange$.pipe(F(()=>this.lastSnapshot),Bt(this.lastSnapshot),G(),tt({bufferSize:1,refCount:!0}))}};b();$();P();v();function We(o){return H[o]!==void 0}b();$();P();v();function Ht(o,s){const c=xe(o.address,s.address),p=o.chainId===s.chainId;return c&&p}var Ke=class{constructor(o){this.applicationContext=o,this.subscription=new Vt,this.source=new jt,this.destination=new jt,this.pairChance$=new ot}init(){this.restorePair(),this.startChainTokenSync()}restorePair(){this.restoreToken("source"),this.restoreToken("destination")}switchPair(){const{source:o,destination:s}=this;this.source=s,this.destination=o,this.updateTokenStore("source"),this.updateTokenStore("destination"),this.pairChance$.next()}setPair(o){this.setTokenInner(o.source,"source"),this.setTokenInner(o.destination,"destination"),this.pairChance$.next()}setToken(o,s){if(s==="source"&&o!==null){const c=this.destination.getSnapshot();if(c.token!==null&&Ht(o,c.token))return this.switchPair()}if(s==="destination"&&o!==null){const c=this.source.getSnapshot();if(c.token!==null&&Ht(o,c.token))return this.switchPair()}this.setTokenInner(o,s)}setAmount(o,s){this.getTokenContext(o).setAmount(s),this.updateTokenStore(o)}streamSnapshot(o){return this.pairChance$.pipe(Bt(null),st(()=>this.getTokenContext(o).streamSnapshot()))}getSnapshot(o){return this.getTokenContext(o).getSnapshot()}destroy(){this.subscription.unsubscribe()}setTokenInner(o,s){this.getTokenContext(s).setToken(o),this.updateTokenStore(s)}getTokenContext(o){if(o==="source")return this.source;if(o==="destination")return this.destination;throw new Error(`invalid token type ${o}`)}updateTokenStore(o){const c=this.getTokenContext(o).getSnapshot(),p=c.amount;if(p!==null&&this.applicationContext.storageController.set(this.tokenStoreKey(o)+"_amount",p.toString()),c.token!==null){const{symbol:h,address:d,chainId:a,name:y,decimals:m}=c.token;this.applicationContext.storageController.set(this.tokenStoreKey(o),{symbol:h,address:d,chainId:a,name:y,decimals:m})}}restoreToken(o){const s=this.getTokenContext(o),c=this.applicationContext.storageController.get(this.tokenStoreKey(o)+"_amount",String),p=this.applicationContext.storageController.get(this.tokenStoreKey(o),yt);p!==null&&s.setToken(p),c!==null&&s.setAmount(BigInt(c))}tokenStoreKey(o){return`token_${o}`}startChainTokenSync(){this.subscription.add(this.applicationContext.connectWalletController.data.chainId$.pipe(st(async o=>{if(!o||!We(o))return;const s=this.source.getSnapshot(),c=this.destination.getSnapshot();if(s.token&&s.token.chainId!==o){const p=await this.applicationContext.tokenController.getNativeToken(o);this.setTokenInner(p,"source")}c.token&&c.token.chainId!==o&&this.setTokenInner(null,"destination")})).subscribe())}};b();$();P();v();var Ge=class{constructor(o,s,c){this.pairHolder=o,this.walletController=s,this.rateProvider=c}async getDataSnapshot(){const o=this.pairHolder.getSnapshot("source"),s=this.pairHolder.getSnapshot("destination"),{token:c,amount:p}=o,{token:h}=s,d=await this.walletController.data.getChainId(),a=await this.walletController.data.getActiveAddress();if(d===null||c===null||h===null||p===null||a===null)throw new Error("");const y=await this.rateProvider.getOnChainRate(d,c,h);if(y===null)throw new Error("");let m;return y.revertedRate?m=X.div(p,y.revertedRate,c.decimals,h.decimals,h.decimals):m=X.mul(p,y.rate,c.decimals,c.decimals,h.decimals),{chainId:d,sourceToken:c,destinationToken:h,sourceTokenAmount:p,destinationTokenAmount:m,rate:y,minReceive:m,autoAuctionTime:null,autoSlippage:null,rawResponseData:null}}};b();$();P();v();var qe=class{constructor(o,s,c,p,h){this.swapContext=o,this.pairHolder=s,this.walletController=c,this.settings=p,this.devPortalAdapter=h}async getDataSnapshot(){const o=this.pairHolder.getSnapshot("source"),s=this.pairHolder.getSnapshot("destination");let{token:c}=o;const{amount:p}=o,{token:h}=s,d=await this.walletController.data.getChainId(),a=await this.walletController.data.getActiveAddress();if(d===null||c===null||h===null||p===null||a===null||p===0n)throw new Error("");if(await this.swapContext.getMaxAmount()<p)throw new Error("");Wt(c.address)&&(c=_e(d));const m=await this.devPortalAdapter.getFusionQuoteReceive(d,c.address,h.address,p,a);if(m===null)throw new Error("");const{toTokenAmount:_,recommended_preset:B,presets:E,autoK:T}=m,f=E[B],w=BigInt(_),I=X.div(w,p,h.decimals,c.decimals),k=X.div(p,w,c.decimals,h.decimals),R={chainId:d,rate:I,revertedRate:k,isReverted:!1,sourceToken:c,destinationToken:h},A=this.settings.slippage;let D=BigInt(f.auctionEndAmount);if(A.value!==null){const[O]=A.value,N=X.calculatePercentage(w,O);D=w-N}return{chainId:d,sourceToken:c,destinationToken:h,sourceTokenAmount:p,minReceive:D,destinationTokenAmount:w,autoAuctionTime:f.auctionDuration,autoSlippage:T,rate:R,rawResponseData:m}}},Ye=class{constructor(o){this.applicationContext=o,this.pairHolder=new Ke(this.applicationContext),this.subscription=new Vt,this.oneInchApiAdapter=new pe,this.walletController=this.applicationContext.connectWalletController,this.settings={slippage:new Ft("slippage"),auctionTime:new Ft("auctionTime")},this.contextStrategy={onChain:new Ge(this.pairHolder,this.walletController,this.applicationContext.tokenRateProvider),fusion:new qe(this,this.pairHolder,this.walletController,this.settings,this.oneInchApiAdapter)},this.loading$=new Kt(!1),this.chainId$=Dt(()=>this.walletController.data.chainId$).pipe(G()),this.connectedWalletAddress$=Dt(()=>this.walletController.data.activeAddress$).pipe(G()),this.block$=this.chainId$.pipe(st(s=>s?Ee(s):Ue(null))),this.updateData$=new ot,this.updateDataComplete$=new ot,this.dataUpdateEmitter$=Ot(this.block$,this.chainId$,this.connectedWalletAddress$,this.pairHolder.streamSnapshot("source"),this.pairHolder.streamSnapshot("destination"),this.updateData$).pipe(be(500),F(()=>{}),Bt(void 0),tt({bufferSize:1,refCount:!0})),this.dataSnapshot$=this.dataUpdateEmitter$.pipe(Pe(this.connectedWalletAddress$),st(([s,c])=>(this.loading$.next(!0),this.getDataSnapshot(c===null))),Lt(()=>{this.loading$.next(!1),this.updateDataComplete$.next()}),tt({bufferSize:1,refCount:!0})),this.rate$=this.dataSnapshot$.pipe(F(s=>(s==null?void 0:s.rate)??null)),this.minReceive$=this.dataSnapshot$.pipe(F(s=>(s==null?void 0:s.minReceive)??0n)),this.destinationTokenAmount$=this.dataSnapshot$.pipe(F(s=>(s==null?void 0:s.destinationTokenAmount)??0n)),this.autoSlippage$=this.dataSnapshot$.pipe(F(s=>(s==null?void 0:s.autoSlippage)??null)),this.autoAuctionTime$=this.dataSnapshot$.pipe(F(s=>(s==null?void 0:s.autoAuctionTime)??null)),this.slippage$=Nt([this.autoSlippage$,this.settings.slippage.value$]).pipe(F(([s,c])=>c?{type:c[1],value:c[0]}:{type:"auto",value:s}),tt({bufferSize:1,refCount:!0})),this.auctionTime$=Nt([this.autoAuctionTime$,this.settings.auctionTime.value$]).pipe(F(([s,c])=>c?{type:c[1],value:c[0]}:{type:"auto",value:s}),tt({bufferSize:1,refCount:!0}))}init(){this.pairHolder.init(),this.subscription.add(Ot(this.destinationTokenAmount$.pipe(G(),Lt(o=>{this.setTokenAmountByType("destination",o)}),Be($e))).subscribe())}wrapNativeToken(o){throw new Error("Method not implemented.")}getApprove(){throw new Error("Method not implemented.")}getSettingsController(o){const s=this.settings[o];if(!s)throw new Error("");return s}async getPermit(){const o=await this.walletController.data.getChainId(),s=await this.walletController.data.getActiveAddress(),c=this.pairHolder.getSnapshot("source");if(!o||!s||!ze(c))throw new Error("");if(await Mt(o,c.token.address,s,nt(o))!==null)return;const h=await Ie(o,c.token.address,s,nt(o)),d=await this.walletController.signTypedData(h);await Se(o,c.token.address,s,nt(o),d,h.message)}destroy(){this.pairHolder.destroy(),this.subscription.unsubscribe()}setPair(o){this.pairHolder.setPair(o)}setToken(o,s){this.pairHolder.setToken(s,o)}switchPair(){this.pairHolder.switchPair()}async getSnapshot(){this.updateData$.next(),await it(this.updateDataComplete$);const[o,s,c]=await Promise.all([it(this.dataSnapshot$),it(this.slippage$),it(this.auctionTime$)]);return{...o,slippage:s,auctionTime:c}}async fusionSwap(o){const{chainId:s,sourceToken:c,destinationToken:p,sourceTokenAmount:h,destinationTokenAmount:d,slippage:a,auctionTime:y,rawResponseData:m}=o,_=await this.walletController.data.getActiveAddress();if(_===null)throw new Error("Wallet not connected");if(!m)throw new Error("");const B=await this.getFusionSDKInstance(s),E=await Mt(s,c.address,_,nt(s)),T={walletAddress:_,fromTokenAddress:c.address,toTokenAddress:p.address,amount:h.toString(),preset:m.recommended_preset};E&&(T.permit=await Ae(s,_,E.signature,E.permitSingle),T.isPermit2=!0);const{type:f,value:w}=a,{type:I,value:k}=y;if(f!=="auto"||I!=="auto"){const A=m.presets[m.recommended_preset],D=d-X.calculatePercentage(d,w??m.autoK);T.customPreset={auctionEndAmount:D.toString(),auctionDuration:k??A.auctionDuration,auctionStartAmount:A.auctionStartAmount},T.preset="custom"}const R=await B.createOrder(T);await B.submitOrder(R.order,R.quoteId)}async getMaxAmount(){const s=this.pairHolder.getSnapshot("source").token,c=await this.walletController.data.getActiveAddress();if(!s||!c)return 0n;const p=await this.applicationContext.tokenController.getTokenBalance(s.chainId,s.address,c);let h=BigInt((p==null?void 0:p.amount)??0);if(Wt(s.address)){const d=await this.walletController.data.getChainId();if(!d)return 0n;const[a,y]=await Promise.all([Te(d,h),this.oneInchApiAdapter.getGasPrice(d)]);if(!y)return 0n;const m=y.high,_=a*(BigInt(m.maxFeePerGas)+BigInt(m.maxPriorityFeePerGas));h=h-_,h<0n&&(h=0n)}return h}async setMaxAmount(){const o=await this.getMaxAmount();this.setTokenAmountByType("source",o)}getTokenByType(o){return this.pairHolder.streamSnapshot(o).pipe(F(s=>s.token),G())}getTokenAmountByType(o){return this.pairHolder.streamSnapshot(o).pipe(F(s=>s.amount),G())}getTokenRawAmountByType(o){return this.pairHolder.streamSnapshot(o).pipe(F(s=>s.amount),G())}setTokenAmountByType(o,s){this.pairHolder.setAmount(o,s)}async getFusionSDKInstance(o){const{FusionSDK:s}=await he(async()=>{const{FusionSDK:c}=await import("./esm-WMGHUIL7-yhki3Y2y.js");return{FusionSDK:c}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));return new s({url:Ce("oneInchDevPortalHost")+"/fusion",network:o,blockchainProvider:new Je(o,this.walletController),httpProvider:new Xe})}async getDataSnapshot(o){if(!o)try{return await this.contextStrategy.fusion.getDataSnapshot()}catch{return this.getDataSnapshot(!0)}try{return await this.contextStrategy.onChain.getDataSnapshot()}catch{return null}}};function ze(o){return o.token!==null&&o.amount!==null}var Je=class{constructor(o,s){this.chainId=o,this.walletController=s,this.client=ke(this.chainId)}async signTypedData(o,s){return await this.walletController.signTypedData(s)}async ethCall(o,s){return(await this.client.call({to:o,data:s})).data??""}},Xe=class{async get(o){return(await fetch(o)).json()}async post(o,s){return(await fetch(o,{method:"POST",body:JSON.stringify(s)})).json().catch(()=>{})}};b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();b();$();P();v();var Qe=Symbol("SwapContextToken");b();$();P();v();var Ze=[H.eth,H.bnb,H.matic,H.arbitrum,H.avalanche,H.op,H.gnosis,H.fantom];function tr(o){return Ze.includes(o)}const wr=Object.freeze(Object.defineProperty({__proto__:null,SwapContext:Ye,SwapContextToken:Qe,isSupportFusion:tr},Symbol.toStringTag,{value:"Module"}));export{Fe as B,Qe as S,hr as _,b as a,$ as b,P as c,v as d,pr as e,Q as f,cr as g,dr as h,tr as i,wr as j,Pe as w};
//# sourceMappingURL=index.esm-gX2eCmPk.js.map
