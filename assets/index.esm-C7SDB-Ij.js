import{i as p,a as T,c as k,t as w,b as E,n as g,s as $,d as q,x as o,e as F,f as b,h as l,j as X,R as O,B as S,S as Q,k as G,l as z,o as B,p as R,q as H,u as L,T as f,v as A,w as J,y as j,z as K,A as N,C as Y,D as Z,E as U,F as tt,G as C,H as D,I as et,J as st,K as nt,L as M,M as P,N as W,O as it,P as rt,Q as ot}from"./index-DsNu59EV.js";var at=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,n=(t,e,s,r)=>{for(var i=r>1?void 0:r?ct(e,s):e,a=t.length-1,u;a>=0;a--)(u=t[a])&&(i=(r?u(e,s,i):u(i))||i);return r&&i&&at(e,s,i),i},lt=p`:host{display:flex;flex-direction:column;height:100%;width:100%}.empty{pointer-events:none}`,I=X(Symbol("select token context")),dt=class{constructor(){this.chainId$=new O(1),this.connectedWalletAddress$=new S(null),this.searchToken$=new S(""),this.changeFavoriteTokenState$=new Q,this.searchInProgress$=new S(!1),this.favoriteTokens$=this.chainId$.pipe(G(t=>f.liveQuery(()=>f.getAllFavoriteTokenAddresses(t)))),this.tokenAddressList$=z([this.chainId$,this.connectedWalletAddress$,this.searchToken$.pipe(B(300),R(""),H())]).pipe(L(([t,e,s])=>f.getSortedForViewTokenAddresses(t,s,e??void 0)),l(()=>this.searchInProgress$.next(!1)))}setChainId(t){this.chainId$.next(t)}setConnectedWalletAddress(t){this.connectedWalletAddress$.next(t??null)}async setFavoriteTokenState(t,e,s){await f.setFavoriteState(t,e,s),this.changeFavoriteTokenState$.next([t,e])}setSearchToken(t){this.searchInProgress$.next(!0),this.searchToken$.next(t)}getSearchTokenValue(){return this.searchToken$.value}},ht=p`.search-token-input-container{display:flex;background-color:var(--color-background-bg-secondary);height:48px;border-radius:12px;color:var(--color-content-content-tertiary);align-items:center;padding-left:12px;padding-right:12px;box-sizing:border-box;gap:8px;margin-top:5px;transition:box-shadow .2s}.search-token-input{border:none;background-color:transparent;height:100%;width:100%;outline:0;color:var(--color-content-content-primary);font-size:16px;font-style:normal;font-weight:400;line-height:24px}.loader{width:24px;min-width:24px;height:24px;min-height:24px;border-radius:50%;border:2px solid;border-bottom-color:var(--secondary);border-top-color:var(--secondary);animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.search-token-input::placeholder{color:var(--color-content-content-secondary)}@media (hover:hover){.search-token-input-container:hover{box-shadow:0 0 0 1px var(--primary)}}.search-token-input-container__focused{box-shadow:0 0 0 1px var(--primary)}`,d=class extends ${constructor(){super(...arguments),this.isFocused=!1,this.searchInProgress=!1}render(){const t={"search-token-input-container":!0,"search-token-input-container__focused":this.isFocused};return o`<div class="${F(t)}"><inch-icon icon="search24"></inch-icon><input id="search" autofocus autocomplete="off" maxlength="40" @input="${e=>this.onChange(e)}" @focus="${()=>this.isFocused=!0}" @blur="${()=>this.isFocused=!1}" placeholder="Search token by name or address" class="search-token-input"> ${A(this.searchInProgress,()=>o`<span class="loader"></span>`,()=>o``)}</div>`}async firstUpdated(){var t;b(this,[((t=this.context)==null?void 0:t.searchInProgress$.pipe(l(e=>this.searchInProgress=e)))??J()],{requestUpdate:!1})}onChange(t){var s;const e=t.target.value;(s=this.context)==null||s.setSearchToken(e)}};d.tagName="inch-search-token-input";d.styles=ht;n([T()],d.prototype,"isFocused",2);n([T()],d.prototype,"searchInProgress",2);n([k({context:j})],d.prototype,"sceneContext",2);n([k({context:I})],d.prototype,"context",2);d=n([w(d.tagName)],d);var pt=p`:host{height:72px;width:100%;outline:0;user-select:none;-webkit-tap-highlight-color:transparent}.item-container{padding:12px 16px;display:flex;gap:8px;align-items:center;cursor:pointer;border-radius:16px;transition:background-color .2s}.name-and-balance{display:flex;flex-direction:column;gap:4px;max-width:50%}.name-and-balance .name{color:var(--color-content-content-primary);font-size:16px;font-style:normal;font-weight:500;line-height:24px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.name-and-balance .balance{color:var(--color-content-content-secondary);font-size:14px;font-style:normal;font-weight:400;line-height:20px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.usd-balance{color:var(--color-content-content-primary);text-align:right;font-size:16px;font-style:normal;font-weight:500;line-height:24px;white-space:nowrap}.usd-balance-and-favorite-start{display:flex;align-items:center;margin-left:auto}.usd-balance-and-favorite-start:dir(rtl){margin-right:auto;margin-left:0}.is-favorite-start{width:32px;height:32px;display:flex;align-items:center;justify-content:center}@media (hover:hover){.item-container:hover{background-color:var(--color-background-bg-secondary)}.item-container:not(.is-favorite-token) .usd-balance{transform:translateX(24px);transition:transform .2s}.item-container:not(.is-favorite-token) .usd-balance:dir(rtl){transform:translateX(-24px);transition:transform .2s}.item-container:not(.is-favorite-token) .is-favorite-start{transform:scale(0);transition:transform .2s}.item-container:hover .is-favorite-start{transform:scale(1)}.item-container:hover .usd-balance{transform:translateX(0)}.item-container:hover .usd-balance:dir(rtl){transform:translateX(0)}}${E(p`.item-container{padding:8px 8px}`)}.item-container:active{background-color:var(--color-background-bg-secondary)}`,ut=p`:host{height:72px;width:100%}.item-container{padding:12px 16px;display:flex;gap:8px;align-items:center;cursor:pointer;border-radius:16px;transition:background-color .2s}.name-and-balance{display:flex;flex-direction:column;gap:4px;width:100%}.stub-loader{will-change:filter;animation:stub-loader-animation 3s ease-in-out infinite}.stub-token-icon{min-width:40px;min-height:40px;border-radius:50%;background-color:var(--color-background-bg-secondary)}.name-stub{background-color:var(--color-background-bg-secondary);height:24px;width:40%;border-radius:8px}.balance-stub{background-color:var(--color-background-bg-secondary);height:20px;width:30%;border-radius:8px}@keyframes stub-loader-animation{0%,100%{filter:opacity(1)}50%{filter:opacity(.5)}}${E(p`.item-container{padding:8px 8px}`)}`,x=class extends ${constructor(){super(...arguments),this.notShowLoader=!1}render(){const t={"item-container":!0,"stub-loader":!this.notShowLoader};return o`<div class="${F(t)}"><div class="stub-token-icon"></div><div class="name-and-balance"><span class="name-stub"></span> <span class="balance-stub"></span></div></div>`}};x.tagName="inch-token-list-stub-item";x.styles=ut;n([g({type:Boolean,attribute:!0})],x.prototype,"notShowLoader",2);x=n([w(x.tagName)],x);function V(t,e,s){it(t,"selectToken",e,s)}var h=class extends ${constructor(){super(...arguments),this.isDestroy=!1,this.preRenderTemplate=null,this.isFavorite=!1,this.task=new K(this,async([t,e,s,r])=>{if(r){const m=this.task.value;if(m)return m}if(!t||!e)return[];if(this.isDestroy)throw new Error("");const i=await f.getToken(t,e);let a=null,u=null;if(s&&i){a=await f.getTokenBalance(t,e,s);const m=await f.getTokenUSDPrice(t,e),_=N(BigInt((a==null?void 0:a.amount)??0),i.decimals);u=Number(_)*Number(m)}return[i,a,u]},()=>[this.chainId,this.tokenAddress,this.walletAddress,!1])}disconnectedCallback(){super.disconnectedCallback(),this.isDestroy=!0}firstUpdated(){b(this,Y(Z(12e3),this.getTokenUpdateEmitter()).pipe(L(()=>this.task.run([this.chainId,this.tokenAddress,this.walletAddress,!1]))),{requestUpdate:!1})}render(){return o`${this.task.render({complete:([t,e,s])=>this.getTokenView(t,e,s),pending:()=>this.preRenderTemplate?this.preRenderTemplate:this.getStub(),error:()=>this.preRenderTemplate?this.preRenderTemplate:this.getStub()})}`}getTokenView(t,e,s){if(!t)return this.getStub();this.isFavorite=t.isFavorite??!1;let r="0";e&&(r=U(N(BigInt(e.amount),t.decimals),6));let i="$0";s&&(i="$"+U(s.toString(),2));let a={border:"var(--color-border-border-secondary)",body:"none"};this.isFavorite&&(a={border:"var(--color-core-orange-warning)",body:"var(--color-core-orange-warning)"});const u={"item-container":!0,"is-favorite-token":t.isFavorite};return this.preRenderTemplate=o`<div class="${F(u)}" @click="${m=>V(this,t,m)}"><inch-token-icon symbol="${t.symbol}" address="${t.address}" chainId="${t.chainId}" size="40"></inch-token-icon><div class="name-and-balance"><span class="name">${t.name}</span> <span class="balance">${r} ${t.symbol}</span></div><div class="usd-balance-and-favorite-start"><span class="usd-balance">${i}</span><inch-icon class="is-favorite-start" @click="${m=>this.onMarkFavoriteToken(m,t)}" icon="startDefault16" .props="${a}"></inch-icon></div></div>`,this.preRenderTemplate}async onMarkFavoriteToken(t,e){var s;t.preventDefault(),t.stopPropagation(),this.isFavorite=!e.isFavorite,await this.task.run([this.chainId,this.tokenAddress,this.walletAddress,!0]),await((s=this.context)==null?void 0:s.setFavoriteTokenState(e.chainId,e.address,!e.isFavorite))}getTokenUpdateEmitter(){if(!this.context)throw new Error("");return this.context.changeFavoriteTokenState$.pipe(tt(([t,e])=>{var r,i;const s=((i=(r=this.task)==null?void 0:r.value)==null?void 0:i[0])??null;return s&&s.chainId===t&&rt(s.address,e)}))}getStub(){return o`<inch-token-list-stub-item></inch-token-list-stub-item>`}};h.tagName="inch-token-list-item";h.styles=pt;n([g({type:String,attribute:!0})],h.prototype,"tokenAddress",2);n([g({type:String,attribute:!0})],h.prototype,"walletAddress",2);n([g({type:Number,attribute:!0})],h.prototype,"chainId",2);n([k({context:I})],h.prototype,"context",2);h=n([w(h.tagName)],h);var mt=p`:host{height:50vh;width:100%}.overlay-message{position:absolute;top:35%;left:0;width:100%;text-align:center;color:var(--color-content-content-primary);display:flex;flex-direction:column;justify-content:center;align-items:center}${E(p`:host{height:100%;width:100%}`)}`,c=class extends ${constructor(){super(...arguments),this.chainId=null,this.walletAddress=null,this.isEmpty=!1,this.addressList$=C(()=>this.getTokenAddressList()).pipe(l(t=>{this.isEmpty=t.length===0,this.requestUpdate()}),D({refCount:!0,bufferSize:1}))}render(){var i;const e=(((i=this.context)==null?void 0:i.getSearchTokenValue())??"")!=="",s=!et(this.chainId),r=st(this.chainId??nt.eth);return o`${A(s,()=>o`<div class="overlay-message"><h3>Unsupported chain</h3></div>`)} ${A(this.isEmpty&&e&&!s,()=>o`<div class="overlay-message"><inch-icon icon="emptySearch"></inch-icon><h3>Token not found on ${r.name} Network</h3><span>Try changing your search query, or switch to another Network</span></div>`)}<inch-scroll-view-virtualizer-consumer .header="${this.header}" .items="${M(this.addressList$,this.getStubAddresses())}" .keyFunction="${a=>[this.chainId,this.walletAddress,a].join(":")}" .renderItem="${a=>o`<inch-token-list-item tokenAddress="${a}" walletAddress="${P(this.walletAddress??void 0)}" chainId="${P(this.chainId??void 0)}"></inch-token-list-item>`}"></inch-scroll-view-virtualizer-consumer>`}async firstUpdated(){b(this,[this.getConnectedWalletAddress().pipe(l(t=>this.walletAddress=t)),this.getChainId().pipe(l(t=>this.chainId=t)),this.addressList$],{requestUpdate:!1}),b(this,[this.getFavoriteTokens()])}getTokenAddressList(){if(!this.context)throw new Error("");return this.context.tokenAddressList$}getChainId(){if(!this.context)throw new Error("");return this.context.chainId$}getFavoriteTokens(){if(!this.context)throw new Error("");return this.context.favoriteTokens$}getConnectedWalletAddress(){if(!this.context)throw new Error("");return this.context.connectedWalletAddress$}getStubAddresses(){return Array.from(Array(30)).map((t,e)=>`0x${e.toString(16)}`)}};c.tagName="inch-token-list";c.styles=[mt];n([g({type:Object})],c.prototype,"header",2);n([k({context:I})],c.prototype,"context",2);n([k({context:j})],c.prototype,"sceneContext",2);n([T()],c.prototype,"chainId",2);n([T()],c.prototype,"walletAddress",2);n([T()],c.prototype,"isEmpty",2);c=n([w(c.tagName)],c);var ft=p`:host{display:flex;width:100%;height:60px}:host(.empty){height:16px;padding-bottom:0;margin-bottom:0}:host(.transition-host){transition:height .2s,padding-bottom .2s,margin-bottom .2s}:host(.remove-favorite-token-show) .remove-favorite-token{transform:scale(1) translate(0,0)}.favorite-container-scroll{overflow-y:hidden;overflow-x:auto;touch-action:pan-x;position:relative;width:100%;padding-top:16px;padding-bottom:8px;margin-bottom:8px;height:36px;scrollbar-width:none}.favorite-container-scroll::-webkit-scrollbar{display:none}.favorite-container{display:flex;gap:12px;height:36px;position:absolute}.favorite-token-item-container{position:relative}.remove-favorite-token{position:absolute;top:-8px;right:-8px;width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center;background-color:var(--color-background-bg-secondary);z-index:9;transition:transform .2s;transform:scale(0) translate(-16px,16px);cursor:pointer;color:var(--color-content-content-primary)}@media (hover:hover){.favorite-token-item-container:hover .remove-favorite-token{transform:scale(1) translate(0,0)}.remove-favorite-token:hover{background-color:var(--secondary-hover)}.edit-favorite-token-list{display:none}}`,y=class extends ${constructor(){super(...arguments),this.editAllMode$=new S(!1),this.favoriteTokensView$=z([C(()=>this.getFavoriteTokens()),C(()=>this.getChainId())]).pipe(B(0),L(([t,e])=>f.getTokenList(e,t)),W(t=>t.sort((e,s)=>s.priority-e.priority)),R([]),l(t=>{t.length&&this.classList.contains("empty")&&this.classList.remove("empty"),!t.length&&!this.classList.contains("empty")&&this.classList.add("empty")}),l(()=>{this.classList.contains("transition-host")||setTimeout(()=>{this.classList.add("transition-host")},300)}),W(t=>(t.length&&t.push(null),o`<div class="favorite-container-scroll"><div class="favorite-container">${o`${ot(t,e=>e!==null?"t"+e.address:"edit",vt,e=>A(e,s=>o`<div class="favorite-token-item-container"><div class="remove-favorite-token" @click="${r=>this.onRemoveFavoriteToken(s,r)}"><inch-icon icon="cross8"></inch-icon></div><inch-button size="m" type="secondary" class="favorite-token-item" @click="${r=>V(this,s,r)}"><inch-token-icon symbol="${s.symbol}" address="${s.address}" chainId="${s.chainId}"></inch-token-icon><span>${s.symbol}</span></inch-button></div>`,()=>o`<inch-button size="l" type="secondary" class="favorite-token-item edit-favorite-token-list" @click="${()=>this.editAllMode$.next(!this.editAllMode$.value)}"><inch-icon icon="edit24"></inch-icon></inch-button>`))}`}</div></div>`)),D({bufferSize:1,refCount:!0}))}firstUpdated(){b(this,this.editAllMode$.pipe(l(t=>{t?this.classList.add("remove-favorite-token-show"):this.classList.remove("remove-favorite-token-show")})),{requestUpdate:!1})}render(){return o`${M(this.favoriteTokensView$)}`}getFavoriteTokens(){if(!this.context)throw new Error("");return this.context.favoriteTokens$}getChainId(){if(!this.context)throw new Error("");return this.context.chainId$}async onRemoveFavoriteToken(t,e){var s;e.stopPropagation(),e.preventDefault(),await((s=this.context)==null?void 0:s.setFavoriteTokenState(t.chainId,t.address,!1))}};y.tagName="inch-favorite-tokens";y.styles=[ft];n([k({context:I})],y.prototype,"context",2);y=n([w(y.tagName)],y);var vt={deleteElement:async t=>{t.style.overflow="hidden",await t.animate([{flexBasis:`${t.offsetWidth}px`,transform:"scale(1) translateX(0)"},{flexBasis:"0",transform:"scale(0) translateX(-20%)"}],{duration:t.id==="edit"?50:150}).finished,t.style.overflow=""},addedElement:async t=>{t.style.overflow="hidden",t.style.transform="scale(0) translateX(-20%)",t.style.position="absolute",t.style.top="-9999",t.style.left="-9999",document.body.appendChild(t),await new Promise(s=>requestAnimationFrame(s));const e=t.offsetWidth;return t.remove(),t.style.position="",t.style.top="",t.style.left="",async s=>{await s.animate([{flexBasis:"0",transform:"scale(0) translateX(-20%)"},{flexBasis:`${e}px`,transform:"scale(1) translateX(0)"}],{duration:150}).finished,s.style.transform="",s.style.overflow=""}}},v=class extends ${constructor(){super(...arguments),this.isEmpty=!0,this.context=new q(this,{context:I})}render(){const t={empty:this.isEmpty};return this.initContext(),o`<inch-token-list class="${F(t)}" .header="${()=>o`<div style="margin-left:1px;margin-right:1px;pointer-events:auto"><inch-card-header backButton headerText="Select token"></inch-card-header><inch-search-token-input></inch-search-token-input><inch-favorite-tokens></inch-favorite-tokens></div>`}"></inch-token-list>`}firstUpdated(){b(this,[this.getTokenAddressList().pipe(l(t=>this.isEmpty=t.length===0))])}updated(t){let e=!1;const s=this.context.value;t.has("chainId")&&this.chainId&&(s.setChainId(this.chainId),e=!0),t.has("connectedWalletAddress")&&(s.setConnectedWalletAddress(this.connectedWalletAddress),e=!0),e&&this.requestUpdate()}initContext(){if(this.context.value)return;const{chainId:t,connectedWalletAddress:e}=this;if(!t)throw new Error("");const s=new dt;s.setChainId(t),s.setConnectedWalletAddress(e),this.context.setValue(s)}getTokenAddressList(){if(!this.context.value)throw new Error("");return this.context.value.tokenAddressList$}};v.tagName="inch-select-token";v.styles=lt;n([g({type:Number})],v.prototype,"chainId",2);n([g({type:String})],v.prototype,"connectedWalletAddress",2);v=n([w(v.tagName)],v);export{v as SelectTokenElement};
//# sourceMappingURL=index.esm-C7SDB-Ij.js.map
